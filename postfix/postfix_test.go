package postfix_test

import (
	"reflect"
	"testing"

	"github.com/Goathy/parenthesis/postfix"
)

// Detailed examples https://en.wikipedia.org/wiki/Shunting_yard_algorithm
func TestPostfix(t *testing.T) {
	tt := []struct {
		desc  string
		input []string
		want  []string
	}{
		{
			desc:  "3 + 4 * 2 / ( 1 - 5 ) ^ 2 ^ 3",
			input: []string{"3", "+", "4", "*", "2", "/", "(", "1", "-", "5", ")", "^", "2", "^", "3"},
			want:  []string{"3", "4", "2", "*", "1", "5", "-", "2", "3", "^", "^", "/", "+"},
		},
		{
			desc:  "(53)",
			input: []string{"(", "53", ")"},
			want:  []string{"53"},
		},
		{
			desc:  "2+2",
			input: []string{"2", "+", "2"},
			want:  []string{"2", "2", "+"},
		},
		{
			desc:  "4+8*3",
			input: []string{"4", "+", "8", "*", "3"},
			want:  []string{"4", "8", "3", "*", "+"},
		},
		{
			desc:  "(4+8)*3",
			input: []string{"(", "4", "+", "8", ")", "*", "3"},
			want:  []string{"4", "8", "+", "3", "*"},
		},
		{
			desc:  "6/2*(1+2)",
			input: []string{"6", "/", "2", "*", "(", "1", "+", "2", ")"},
			want:  []string{"6", "2", "/", "1", "2", "+", "*"},
		},
		{
			desc:  "8/2*(2+2)",
			input: []string{"8", "/", "2", "*", "(", "2", "+", "2", ")"},
			want:  []string{"8", "2", "/", "2", "2", "+", "*"},
		},
		{
			desc:  "6+9+4^2",
			input: []string{"6", "+", "9", "+", "4", "^", "2"},
			want:  []string{"6", "9", "+", "4", "2", "^", "+"},
		},
		{
			desc:  "5*(6^2-2)",
			input: []string{"5", "*", "(", "6", "^", "2", "-", "2", ")"},
			want:  []string{"5", "6", "2", "^", "2", "-", "*"},
		},
		{
			desc:  "4*8^2+11",
			input: []string{"4", "*", "8", "^", "2", "+", "11"},
			want:  []string{"4", "8", "2", "^", "*", "11", "+"},
		},
		{
			desc:  "46+(8*4)/2",
			input: []string{"46", "+", "(", "8", "*", "4", ")", "/", "2"},
			want:  []string{"46", "8", "4", "*", "2", "/", "+"},
		},
		{
			desc:  "6+9+(4*2+4^2)",
			input: []string{"6", "+", "9", "+", "(", "4", "*", "2", "+", "4", "^", "2", ")"},
			want:  []string{"6", "9", "+", "4", "2", "*", "4", "2", "^", "+", "+"},
		},
		{
			desc:  "7^2*(25+10/5)-13",
			input: []string{"7", "^", "2", "*", "(", "25", "+", "10", "/", "5", ")", "-", "13"},
			want:  []string{"7", "2", "^", "25", "10", "5", "/", "+", "*", "13", "-"},
		},
		{
			desc:  "10-7*(3+2)+7^2",
			input: []string{"10", "-", "7", "*", "(", "3", "+", "2", ")", "+", "7", "^", "2"},
			want:  []string{"10", "7", "3", "2", "+", "*", "-", "7", "2", "^", "+"},
		},
		{
			desc:  "5-3*(2^3-5+7*(-3))",
			input: []string{"5", "-", "3", "*", "(", "2", "^", "3", "-", "5", "+", "7", "*", "(", "-3", ")", ")"},
			want:  []string{"5", "3", "2", "3", "^", "5", "-", "7", "-3", "*", "+", "*", "-"},
		},
		{
			desc:  "2*(1+(4*(2+1)+3))",
			input: []string{"2", "*", "(", "1", "+", "(", "4", "*", "(", "2", "+", "1", ")", "+", "3", ")", ")"},
			want:  []string{"2", "1", "4", "2", "1", "+", "*", "3", "+", "+", "*"},
		},
		{
			desc:  "(3*5^2/15)-(5-2^2)",
			input: []string{"(", "3", "*", "5", "^", "2", "/", "15", ")", "-", "(", "5", "-", "2", "^", "2", ")"},
			want:  []string{"3", "5", "2", "^", "*", "15", "/", "5", "2", "2", "^", "-", "-"},
		},
		{
			desc:  "((3+2)^2+3)-9+3^2",
			input: []string{"(", "(", "3", "+", "2", ")", "^", "2", "+", "3", ")", "-", "9", "+", "3", "^", "2"},
			want:  []string{"3", "2", "+", "2", "^", "3", "+", "9", "-", "3", "2", "^", "+"},
		},
		{
			desc:  "(18/3)^2+((13+7)*5^2)",
			input: []string{"(", "18", "/", "3", ")", "^", "2", "+", "(", "(", "13", "+", "7", ")", "*", "5", "^", "2", ")"},
			want:  []string{"18", "3", "/", "2", "^", "13", "7", "+", "5", "2", "^", "*", "+"},
		},
		{
			desc:  "78+(30-0.5*(28+8))/6",
			input: []string{"78", "+", "(", "30", "-", "0.5", "*", "(", "28", "+", "8", ")", ")", "/", "6"},
			want:  []string{"78", "30", "0.5", "28", "8", "+", "*", "-", "6", "/", "+"},
		},
		{
			desc:  "(5.9-5.3)*7.2+1.4^2",
			input: []string{"(", "5.9", "-", "5.3", ")", "*", "7.2", "+", "1.4", "^", "2"},
			want:  []string{"5.9", "5.3", "-", "7.2", "*", "1.4", "2", "^", "+"},
		},
		{
			desc:  "(2.1^2+5.2-7.2)*7.1",
			input: []string{"(", "2.1", "^", "2", "+", "5.2", "-", "7.2", ")", "*", "7.1"},
			want:  []string{"2.1", "2", "^", "5.2", "+", "7.2", "-", "7.1", "*"},
		},
		{
			desc:  "2*20/2+(3+4)*3^2-6+15",
			input: []string{"2", "*", "20", "/", "2", "+", "(", "3", "+", "4", ")", "*", "3", "^", "2", "-", "6", "+", "15"},
			want:  []string{"2", "20", "*", "2", "/", "3", "4", "+", "3", "2", "^", "*", "+", "6", "-", "15", "+"},
		},
	}
	for _, tc := range tt {
		t.Run(tc.desc, func(t *testing.T) {
			postfix := postfix.New()
			got := postfix.Transform(tc.input)

			if !reflect.DeepEqual(tc.want, got) {
				t.Errorf("want %q, got %q", tc.want, got)
			}
		})
	}
}
